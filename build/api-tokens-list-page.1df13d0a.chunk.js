"use strict";(self.webpackChunkmyapi=self.webpackChunkmyapi||[]).push([[8056],{48601:(Oe,A,s)=>{s.r(A),s.d(A,{default:()=>De});var a=s(67294),o=s(68547),L=s(87751),T=s(97132),k=s(23724),w=s(49656),Z=s(80129),z=s.n(Z),O=s(78862),G=s(62031),Y=s(19408),J=s(80768),S=s.n(J),M=s(23998);const K=[{name:"name",key:"name",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"type",key:"type",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.type",defaultMessage:"Token type"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}}];var X=s(45697),c=s.n(X),h=s(49425),y=s(41798),q=s(67826),_=s(18568),ee=s.n(_),te=s(30741),ne=s(5493),ae=Object.defineProperty,I=Object.getOwnPropertySymbols,se=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable,V=(n,e,t)=>e in n?ae(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,re=(n,e)=>{for(var t in e||(e={}))se.call(e,t)&&V(n,t,e[t]);if(I)for(var t of I(e))oe.call(e,t)&&V(n,t,e[t]);return n};const B=({tokenName:n,onClickDelete:e})=>{const{formatMessage:t}=(0,T.useIntl)(),{trackUsage:d}=(0,o.useTracking)();return a.createElement(ne.Box,re({paddingLeft:1},o.stopPropagation),a.createElement(te.IconButton,{onClick:()=>{d("willDeleteToken"),e()},label:t({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${n}`}),noBorder:!0,icon:a.createElement(ee(),null)}))};B.propTypes={tokenName:c().string.isRequired,onClickDelete:c().func.isRequired};const le=B;var ie=s(19352),ce=s.n(ie),de=s(78384);const ue=(0,de.default)(o.Link)`
  svg {
    path {
      fill: ${({theme:n})=>n.colors.neutral500};
    }
  }

  &:hover {
    svg {
      path {
        fill: ${({theme:n})=>n.colors.neutral800};
      }
    }
  }
`,N=({tokenName:n,tokenId:e})=>{const{formatMessage:t}=(0,T.useIntl)(),{location:{pathname:d}}=(0,w.useHistory)();return a.createElement(ue,{to:`${d}/${e}`,title:t({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:`${n}`})},a.createElement(ce(),null))};N.propTypes={tokenName:c().string.isRequired,tokenId:c().oneOfType([c().string,c().number]).isRequired};const me=N;var pe=Object.defineProperty,R=Object.getOwnPropertySymbols,ye=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable,j=(n,e,t)=>e in n?pe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ge=(n,e)=>{for(var t in e||(e={}))ye.call(e,t)&&j(n,t,e[t]);if(R)for(var t of R(e))fe.call(e,t)&&j(n,t,e[t]);return n};const D=({canDelete:n,canUpdate:e,onClickDelete:t,withBulkActions:d,rows:m})=>{const{formatMessage:f}=(0,T.useIntl)(),[{query:u}]=(0,o.useQueryParams)(),[,p]=u.sort.split(":"),{push:l,location:{pathname:g}}=(0,w.useHistory)(),{trackUsage:E}=(0,o.useTracking)(),C=m.sort((r,v)=>{const P=r.name.localeCompare(v.name);return p==="DESC"?-P:P});return a.createElement(y.Tbody,null,C.map(r=>a.createElement(y.Tr,ge({key:r.id},(0,o.onRowClick)({fn(){E("willEditTokenFromList"),l(`${g}/${r.id}`)},condition:e})),a.createElement(y.Td,null,a.createElement(h.Typography,{textColor:"neutral800",fontWeight:"bold"},r.name)),a.createElement(y.Td,{maxWidth:(0,o.pxToRem)(250)},a.createElement(h.Typography,{textColor:"neutral800",ellipsis:!0},r.description)),a.createElement(y.Td,null,a.createElement(h.Typography,{textColor:"neutral800"},f({id:`Settings.apiTokens.types.${r.type}`,defaultMessage:"Type unknown"}))),a.createElement(y.Td,null,a.createElement(h.Typography,{textColor:"neutral800"},a.createElement(o.RelativeTime,{timestamp:new Date(r.createdAt)}))),d&&a.createElement(y.Td,null,a.createElement(q.Flex,{justifyContent:"end"},e&&a.createElement(me,{tokenName:r.name,tokenId:r.id}),n&&a.createElement(le,{tokenName:r.name,onClickDelete:()=>t(r.id)}))))))};D.defaultProps={canDelete:!1,canUpdate:!1,onClickDelete(){},rows:[],withBulkActions:!1},D.propTypes={canDelete:c().bool,canUpdate:c().bool,onClickDelete:c().func,rows:c().array,withBulkActions:c().bool};const ve=D;var Te=Object.defineProperty,he=Object.defineProperties,Ee=Object.getOwnPropertyDescriptors,$=Object.getOwnPropertySymbols,Pe=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable,x=(n,e,t)=>e in n?Te(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,U=(n,e)=>{for(var t in e||(e={}))Pe.call(e,t)&&x(n,t,e[t]);if($)for(var t of $(e))ke.call(e,t)&&x(n,t,e[t]);return n},F=(n,e)=>he(n,Ee(e)),b=(n,e,t)=>new Promise((d,m)=>{var f=l=>{try{p(t.next(l))}catch(g){m(g)}},u=l=>{try{p(t.throw(l))}catch(g){m(g)}},p=l=>l.done?d(l.value):Promise.resolve(l.value).then(f,u);p((t=t.apply(n,e)).next())});const we=()=>{(0,o.useFocusWhenNavigate)();const n=(0,k.useQueryClient)(),{formatMessage:e}=(0,T.useIntl)(),t=(0,o.useNotification)(),{allowedActions:{canCreate:d,canDelete:m,canUpdate:f,canRead:u}}=(0,o.useRBAC)(L.Z.settings["api-tokens"]),{push:p}=(0,w.useHistory)(),{trackUsage:l}=(0,o.useTracking)(),{startSection:g}=(0,o.useGuidedTour)(),E=(0,a.useRef)(g);(0,a.useEffect)(()=>{E.current&&E.current("apiTokens")},[]),(0,a.useEffect)(()=>{p({search:z().stringify({sort:"name:ASC"},{encode:!1})})},[p]);const C=K.map(i=>F(U({},i),{metadatas:F(U({},i.metadatas),{label:e(i.metadatas.label)})})),{data:r,status:v,isFetching:P}=(0,k.useQuery)(["api-tokens"],()=>b(void 0,null,function*(){l("willAccessTokenList");const{data:{data:i}}=yield M.be.get("/admin/api-tokens");return l("didAccessTokenList",{number:i.length}),i}),{enabled:u,onError(){t({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),H=u&&(v!=="success"&&v!=="error"||v==="success"&&P),be=(0,k.useMutation)(i=>b(void 0,null,function*(){yield M.be.delete(`/admin/api-tokens/${i}`)}),{onSuccess(){return b(this,null,function*(){yield n.invalidateQueries(["api-tokens"]),l("didDeleteToken")})},onError(i){var Q,W;(W=(Q=i==null?void 0:i.response)==null?void 0:Q.data)!=null&&W.data?t({type:"warning",message:i.response.data.data}):t({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),Ce=u&&r,Ae=u&&!r&&!d,Le=u&&!r&&d;return a.createElement(G.Main,{"aria-busy":H},a.createElement(o.SettingsPageTitle,{name:"API Tokens"}),a.createElement(O.HeaderLayout,{title:e({id:"Settings.apiTokens.title",defaultMessage:"API Tokens"}),subtitle:e({id:"Settings.apiTokens.description",defaultMessage:"List of generated tokens to consume the API"}),primaryAction:d?a.createElement(o.LinkButton,{"data-testid":"create-api-token-button",startIcon:a.createElement(S(),null),size:"S",onClick:()=>l("willAddTokenFromList"),to:"/settings/api-tokens/create"},e({id:"Settings.apiTokens.create",defaultMessage:"Create new API Token"})):void 0}),a.createElement(O.ContentLayout,null,!u&&a.createElement(o.NoPermissions,null),Ce&&a.createElement(o.DynamicTable,{headers:C,contentType:"api-tokens",rows:r,withBulkActions:m||f,isLoading:H,onConfirmDelete:i=>be.mutateAsync(i)},a.createElement(ve,{canDelete:m,canUpdate:f,rows:r,withBulkActions:m||f})),Le&&a.createElement(o.NoContent,{content:{id:"Settings.apiTokens.addFirstToken",defaultMessage:"Add your first API Token"},action:a.createElement(Y.Button,{variant:"secondary",startIcon:a.createElement(S(),null)},e({id:"Settings.apiTokens.addNewToken",defaultMessage:"Add new API Token"}))}),Ae&&a.createElement(o.NoContent,{content:{id:"Settings.apiTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})))},De=()=>a.createElement(o.CheckPagePermissions,{permissions:L.Z.settings["api-tokens"].main},a.createElement(we,null))}}]);
